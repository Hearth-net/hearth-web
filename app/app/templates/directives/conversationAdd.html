<div class="messages messages-add">
	<form ng-submit="addMessage(message)" novalidate name="addMessageForm">
		<div class="form-section" ng-if="recipient">
			<label>{{:: 'MESSAGES.ADD.RECIPIENT' | translate }}</label>
			<div class="display-flex margin-top-small">
				<avatar src="recipient.avatar.normal" type="recipient._type" size="mini" class="margin-right-small"></avatar>
				<span title="{{ recipient.name }}">{{ recipient.name | ellipsis:55 }}</span>
			</div>
		</div>
		<div class="form-section" ng-if="!recipient">
			<label>
				{{:: 'MESSAGES.ADD.RECIPIENTS_LABEL' | translate }} *
				<user-selector ng-focus="hideRecipientsError()" ng-blur="showRecipientsError()" users="message.recipients_ids"></user-selector>
			</label>
			<div class="error" ng-show="showError.recipients_ids">{{:: 'MESSAGES.ADD.ERR.RECIPIENTS_NOT_FILLED' | translate }}</div>
		</div>
		<div class="form-section">
			<label>
				{{:: 'MESSAGES.ADD.SUBJECT_LABEL' | translate }}
				<input name="title" ng-required="true" ng-attr-placeholder="{{:: 'MESSAGES.ADD.SUBJECT_PLACEHOLDER' | translate }}" ng-model="message.title" class="text-input" type='text' />
			</label>
		</div>
		<div class="form-section">
			<label>
				{{:: 'MESSAGES.ADD.TEXT_LABEL' | translate }} *
				<!-- <textarea rows="5" name="text" ng-attr-placeholder="{{:: 'MESSAGES.ADD.TEXT_PLACEHOLDER' | translate }}" ng-required="true" ng-minlength="1" ng-focus="showError.text = false" ng-blur="showError.text = true" ng-model="message.text"></textarea> -->
				<textarea ng-disabled="sendingMessage" class="margin-bottom-none" ng-focus="showError.text = false" ng-blur="showError.text = true" rows="5" id="reply-text" name="text" autosize-textarea ng-required="true" ng-attr-placeholder="{{:: 'MESSAGES.ADD.TEXT_PLACEHOLDER' | translate }}"
				ng-model="message.text"></textarea>
			</label>
			<div class="error" ng-show="addMessageForm.text.$invalid && showError.text">
				<span ng-show="addMessageForm.text.$error.required">{{:: 'ERR_AD_TEXT_MIN_LEN' | translate }}</span>
				<span ng-show="addMessageForm.text.$error.minlength">{{:: 'ERR_AD_TEXT_MIN_LEN' | translate }}</span>
				<span ng-show="addMessageForm.text.$error.maxlength">{{:: 'ERR_AD_TEXT_LEN' | translate }}</span>
			</div>
		</div>
		<div id="message-footer" class="display-flex flex-space-between">
			<div>
				<a ng-click="close()" class="revert-changes" tabindex="0">{{:: 'CANCEL' | translate }}</a>
			</div>
			<div class="display-flex">
				<files-picker ng-model="message.attachments_attributes" files-multiple="true"></files-picker>
				<button ng-disabled="sendingMessage" type="submit" class="button-send">
					<i class="fa has-loading-icon" ng-class="{'loading-in-progress': sendingReply}"></i>
					{{:: 'MESSAGES.ADD.SEND_MESSAGE' | translate }}
				</button>
			</div>
		</div>
	</form>
</div>