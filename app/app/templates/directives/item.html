<article class="row post" id="post_{{ item._id }}" ng-class="{mineItem: mine, inactive: !isActive, 'hidden-init': delayedView}">
	<section ng-if="! hideAvatar" class="large-2 columns user">
		<div ng-if="loggedUser._id">
			<div ng-include="'templates/_user-info.html'"></div>
			<a ng-href="#!/{{getProfileLinkByType(item.author._type)}}/{{ item.author._id }}">
				<avatar type="item.author._type" src="item.author.avatar.large"></avatar>
				<div class="name">{{ item.author.name }}</div>
			</a>
		</div>
		<div ng-if="!loggedUser._id">
			<avatar type="item.author._type" src="item.author.avatar.large"></avatar>
			<div class="name">{{ item.author.name }}</div>
		</div>
		<div class="karma" ng-class="{empty: !item.karma}" title="{{ 'COUNT_OF_PLUS_POINTS' | translate }}: {{ item.author.up_votes }} | {{ 'COUNT_OF_MINUS_POINTS' | translate }}: {{ item.author.down_votes }}">
			<div class="positive" style="width:{{item.karma}}"></div>
		</div>
		<div class="timeline"></div>
	</section>
	<section class="item-container columns" ng-class="foundationColumnsClass">
		<div class="item" ng-class="item.type">
			<div class="overlap"> </div>
			<div class="arrowbox"></div>
			<div class="arrow"></div>
			<div class="content">
				<header>
					<div class="locations" ng-if="item.location_unlimited">
						<span class="fa fa-map-marker"></span>
						{{ 'LOCATION_UNLIMITED_MESSAGE' | translate }}
					</div>
					<div class="locations dropdown-container" ng-if="!item.location_unlimited && item.locations.length && item.locations[0].short_address">
						<span class="fa fa-map-marker"></span>
						{{ item.locations[0].short_address }}
						<a ng-if="item.locations.length > 1" dropdown="#locations-{{item._id}}">{{'and-next' | translate: {value: item.locations.length - 1} }}</a>
						<div id="locations-{{item._id}}" class="location-dropdown content">
							<div ng-repeat="location in item.locations track by $index">
								&nbsp;&nbsp;<span class="fa fa-map-marker"></span> {{ location.short_address }}
							</div>
						</div>
					</div>
					<span class="date" title="{{item.updated_at | date:DATETIME_FORMATS.medium}}"><span class="fa fa-clock-o"></span>
						{{item.updated_at | ago}}
					</span>
				</header>
				<h1>
					<span>
						{{ postTypes[item.author._type][item.type] | translate }}
					</span>
					<div ng-if="itemDetail">{{item.title}}</div>
					<a ng-if="! itemDetail" ng-href="#!/ad/{{item._id}}">{{item.title}}</a>
				</h1>
				<div class="text-container">
					<div ng-class="{ 'expandable' : !postExpanded }">
						<p ng-bind-html="item.name | linky:'_blank' | nl2br"></p>
					</div>
				</div>
				<div class="attachments" ng-if="item.attachments_attributes.length" fancybox>
					<div ng-class="{ 'expandable' : !postExpanded }">
						<a class="fancy" ng-href="{{ photo.large }}" rel="{{ item._id }}" ng-repeat="photo in item.attachments_attributes track by $index">
							<img ng-if="$index < 3" ng-src="{{ photo.normal }}">
							<img ng-if="$index >= 3 && !postExpanded" data-src="{{ photo.normal }}" class="lazyLoad">
							<img ng-if="$index >= 3 && postExpanded" ng-src="{{ photo.normal }}">
						</a>
					</div>
				</div>
				<div class="tags" ng-class="{'tagsActive': !inactivateTags}" ng-if="item.keywords.length">
					<ul class="tagList">
						<li ng-click="toggleTag(tag)" ng-class="{active: keywords.indexOf(tag) !== -1}" ng-repeat="tag in item.keywords">
							{{tag}}
						</li>
					</ul>
				</div>
				<a ng-if="showMore && !postExpanded" class="show-more" ng-click="toggleCollapsed()">
					<span>{{ 'show-more' | translate }} <i class="fa fa-chevron-down"></i></span>
					<span>{{ 'show-less' | translate }} <i class="fa fa-chevron-up"></i></span>
				</a>
				<div class="clear"></div>
			</div>
			<footer>
				<a class="report-link spam fa fa-flag" ng-if="! mine && !loggedUser._id" title="{{'REPORT_HARMFUL_AD' | translate}}" ng-click="showLoginBox(true)"></a>
				<a class="report-link spam fa fa-flag" ng-if="! mine && loggedUser._id" title="{{'REPORT_HARMFUL_AD' | translate}}" ng-click="confirmBox('AD_REPORT_CONFIRM', 'AD_REPORT_ARE_YOU_SURE', reportItem, item, this)">
				</a>
				<div class="share">
					<div class="fa fa-share-square-o"></div>
					<div class="sharing">
						<div>
							<a class="fa fa-envelope" title="Email" href="" ng-click="openEmailSharingBox(item)"></a>
							<a class="fa fa-facebook" title="Facebook" ng-href="{{socialLinks.facebook+postAddress}}" target="_blank"></a>
							<a class="fa fa-google-plus" title="Google+" ng-href="{{socialLinks.gplus+postAddress}}" target="_blank"></a>
							<a class="fa fa-twitter" title="Twitter" ng-href="{{socialLinks.twitter+postAddress}}" target="_blank"></a>
						</div>
					</div>
				</div>
				<div class="controll-buttons" ng-if="mine">
					<div class="fa fa-pencil" title="{{'AD_EDIT_LABEL' | translate}}" ng-click="edit(item)"></div>
					<div class="fa " ng-class="{'fa-refresh': item.state == 'expired', 'fa-play': item.state == 'suspended'}" title="{{'AD_RESUME_LABEL' | translate}}" ng-if="!isActive" ng-click="pauseToggle(item, 'confirm-pause-'+item._id)"></div>
					<div class="fa fa-pause" title="{{'AD_PAUSE_LABEL' | translate}}" ng-if="isActive" ng-click="confirmBox('AD_PAUSE_LABEL', 'AD_PAUSE_ARE_YOU_SURE', pauseToggle, item, this)"></div>
					<div class="fa fa-times" title="{{'AD_REMOVE_LABEL' | translate}}" ng-click="confirmBox('AD_REMOVE_LABEL', 'AD_REMOVE_ARE_YOU_SURE', deleteItem, item, this)"></div>
				</div>
				<span ng-if="!mine">
					<button ng-if="! item.is_replied && isActive" ng-click="replyItem(item)" class="small main" ng-class="item.type">
						<span ng-bind-html="replyLabel[item.type] | translate"></span>
					</button>
					<span ng-if="item.is_replied">
						{{ 'YOU_HAVE_ALREADY_REPLIED_TO_THIS_POST' | translate }}
					</span>
				</span>

				<span ng-if="item.reply_count">
					<span class="margin" ng-bind-html="replyCountTexts[item.type]+'.'+pluralCat(item.reply_count) | translate:{value: item.reply_count}"></span>
				</span>
				<span class="margin" ng-if="!item.reply_count">{{'NO_REPLY' | translate}}</span>
				<span ng-if="!isActive">
					&nbsp;&nbsp;&nbsp;
					<span ng-if="item.state == 'expired'">
						<span ng-if="item.valid_until">{{ 'POST_HAS_EXPIRED' | translate  }} {{ item.valid_until | date:DATETIME_FORMATS.mediumDate }}</span>
						<span ng-if="!item.valid_until">{{ 'POST_HAS_ALREADY_EXPIRED' | translate  }}</span>
					</span>
					<span ng-if="item.state == 'suspended'">{{ 'POST_HAS_BEEN_DEACTIVATED' | translate }} {{ item.suspended_at | date:DATETIME_FORMATS.medium }}</span>
				</span>
				<div class="clear"></div>
			</footer>
		</div>
	</section>
</article>