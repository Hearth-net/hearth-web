<article class="row" id="post_{{:: item._id }}" ng-class="{inactive: !isActive, 'hidden-init': delayedView, 'hiddenAvatar': hideAvatar}">
	<section ng-if="! hideAvatar" class="column medium-2 show-for-medium-up">
		<div info-box="item.author">
			<a ng-href="{{:: getProfileLink(item.author._type, item.author._id) }}">
				<avatar type="item.author._type" src="item.author.avatar.large"></avatar>
				<div class="name">{{ item.author.name }}</div>
			</a>
		</div>
		<karma-bar for="item.author"></karma-bar>
	</section>
	<div class="column small-12 medium-10">
		<div class="sharing-container ng-hide" ng-show="showSharing">
			<div>
				<i class="fa fa-times close" ng-click="showSharing = false"></i>
				<h3>{{:: 'MARKETPLACE.POST.SHARE_LINK' | translate }}</h3>
				<input type="text" select-on-focus value="{{:: getProfileLink('Post', item._id, true)}}" />
				<ul>
					<li>
						<a analytics-custom analytics-event="Share" analytics-category="Email" analytics-label="Share post by email" class="fa fa-envelope" title="Email" ng-click="openEmailSharingBox(item)"></a>
					</li>
					<li>
						<a analytics-custom analytics-event="Share" analytics-category="Facebook" analytics-label="Share post on facebook" sharing-window class="fa fa-facebook" title="Facebook" ng-href="{{:: socialLinks.facebook+postAddress}}" target="_blank"></a>
					</li>
					<li>
						<a analytics-custom analytics-event="Share" analytics-category="Google+" analytics-label="Share post on google+" haring-window class="fa fa-google-plus" title="Google+" ng-href="{{:: socialLinks.gplus+postAddress}}" target="_blank"></a>
					</li>
					<li>
						<a analytics-custom analytics-event="Share" analytics-category="Twitter" analytics-label="Share post on twitter" sharing-window class="fa fa-twitter" title="Twitter" ng-href="{{:: socialLinks.twitter+postAddress}}" target="_blank"></a>
					</li>
				</ul>
			</div>
		</div>
		<article class="box" ng-class="item.type" ng-init="marketplace.expanded = false;">
			<header class="row">
				<div class="column small-12 medium-8 large-9">
					<h1>
						<a ng-href="{{:: getProfileLink('Post', item._id)}}">
							<span data-item-type="{{ item.type }}">
								{{ postTypes[item.author._type][item.type] | translate }}
							</span>
							<span ng-bind='item.title'></span>
						</a>
					</h1>
					<span class="nowrap" ng-if="isExpiringSoon">{{:: 'POSTS.DETAIL.POST_EXPIRING_SOON' | translate }}</span>
					<span class="fa fa-lock" ng-if="item.is_private" title="{{:: 'VISIBLE_FOR_FRIENDS' | translate }}"></span>
				</div>
				<div class="column small-12 medium-4 large-3">
					<a ng-if="! hideAvatar" ng-href="{{:: getProfileLink(item.author._type, item.author._id) }}" class="hide-for-medium-up">
						<avatar type="item.author._type" src="item.author.avatar.normal" size="small"></avatar>
					</a>
					<span class="" ng-if="!mine">
						<a class="action-dropdown fa fa-chevron-down" title="{{:: 'POSTS.DETAIL.EXPAND_MORE_INFO' | translate }}" dropdown="#more-actions-{{:: item._id }}"></a>
					</span>
					<div class="more-actions-dropdown" id="more-actions-{{:: item._id }}" style="display:none;">
						<!-- bookmark post -->
						<a ng-if="! mine && item.is_bookmarked" ng-click="removeItemFromBookmarks(item)">{{:: 'MARKETPLACE.POST.UNBOOKMARK_POST' | translate }}</a>
						<a ng-if="! mine && !item.is_bookmarked" ng-click="addItemToBookmarks(item)">{{:: 'MARKETPLACE.POST.BOOKMARK_POST' | translate }}</a>
						<!-- bookmark post -->
						<!-- flag post -->
						<a ng-if="! mine && item.spam_reported" title="{{:: 'REPORT_HARMFUL_AD_ONLY_ONCE' | translate}}" tipsy disabled>{{:: 'MARKETPLACE.POST.FLAG_POST' | translate }}</a>
						<a ng-if="! mine && !item.spam_reported" title="{{:: 'REPORT_HARMFUL_AD' | translate}}" ng-click="openReportBox(item)">{{:: 'MARKETPLACE.POST.FLAG_POST' | translate }}</a>
						<!-- flag post -->
						<a ng-if="! mine && item.admin_communities.length" title="{{:: 'MARKETPLACE.POST.REMOVE_FROM_COMMUNITY' | translate}}" ng-click="removeItemFromCommunity(item)">{{:: 'MARKETPLACE.POST.REMOVE_FROM_COMMUNITY' | translate }}</a>
					</div>
					<span class="" title="{{ item.updated_at | date:DATETIME_FORMATS.medium}}">
						{{item.updated_at | ago}}
					</span>
				</div>

				<div ng-if="item.location_unlimited" class="column small-12">
					<i class="fa fa-map-marker"></i> {{:: 'MARKETPLACE.POST.LOCATION_ANYWHERE_HEADING' | translate }}
				</div>
				<div ng-if="!item.location_unlimited" class="column small-12">
					<span ng-repeat="(locationId, location) in item.locations" ng-if="location.short_address">
						<i class="fa fa-map-marker" ng-if="$first"></i>{{ location.short_address }}
						<span ng-if="!$last">;</span>
					</span>
				</div>
			</header>

			<div class="text-container" ng-if="item.text.length < 270 || marketplace.expanded == true">
				<p ng-bind-html="item.text | linky:'_blank' | nl2br"></p>
			</div>
			<div class="text-container" ng-if="item.text.length >= 270 && !marketplace.expanded">
				<p>
					<span ng-bind-html="item.text_short | linky:'_blank'"></span>
					<a class="inline-block" ng-click="marketplace.expanded = true">{{:: 'MARKETPLACE.POST.CLICK_TO_EXPAND' | translate }}</a>
				</p>
			</div>
			<ul lemmon-slider fancybox ng-if="item.attachments_attributes.length">
				<li ng-repeat="photo in item.attachments_attributes track by $index">
					<a class="fancy" ng-href="{{ photo.large }}" rel="{{:: item._id }}">
						<img ng-src="{{photo.normal}}">
					</a>
				</li>
			</ul>
			<div class="tags" ng-class="{'tagsActive': !inactivateTags}" ng-if="item.keywords.length">
				<ul class="tagList">
					<li ng-click="toggleTag(tag)" ng-class="{active: keywords.indexOf(tag) !== -1}" ng-repeat="tag in item.keywords" ng-bind='tag'></li>
				</ul>
			</div>
			<footer>
				<div class="">
					<button ng-if="!item.is_replied && !mine" ng-click="replyItem(item)" class="button" data-item-type="{{ item.type }}" ng-bind-html="replyLabel[item.type] | translate"></button>
					<div ng-if="item.is_replied">
						{{:: 'YOU_HAVE_ALREADY_REPLIED_TO_THIS_POST' | translate }}
					</div>
				</div>
				<div class="">
					<a analytics-custom analytics-event="Share" analytics-category="Open" analytics-label="Open sharing overlay" class="fa fa-share-alt" ng-click="showSharing = !showSharing" title="Share"></a>
				</div>
				<div class="" ng-if="mine">
					<div class="">
						<a title="{{:: 'AD_EDIT_LABEL' | translate}}" ng-click="edit(item)">
							<i class="fa fa-pencil"></i>
						</a>
						<a title="{{:: 'AD_RESUME_LABEL' | translate}}" ng-if="!isActive" ng-click="pauseToggle(item, 'confirm-pause-'+item._id)">
							<i class="fa " ng-class="{'fa-refresh': item.state == 'expired', 'fa-play': item.state == 'suspended'}"></i>
						</a>
						<a title="{{:: 'AD_PAUSE_LABEL' | translate}}" ng-if="isActive" ng-click="confirmBox('AD_PAUSE_LABEL', 'AD_PAUSE_ARE_YOU_SURE', pauseToggle, item, this)">
							<i class="fa fa-pause"></i>
						</a>
						<a title="{{:: 'AD_REMOVE_LABEL' | translate}}" ng-click="confirmBox('AD_REMOVE_LABEL', 'AD_REMOVE_ARE_YOU_SURE', deleteItem, item, this)">
							<i class="fa fa-times"></i>
						</a>
					</div>
				</div>
				<div class="">
					<div ng-if="item.reply_count && mine">
						<a class="reply-info-link" ng-href="{{:: getProfileLink('Post', item._id) }}#replies" ng-bind-html="replyCountTexts[item.type]+'.'+pluralCat(item.reply_count) | translate:{value: item.reply_count}"></a>
					</div>
					<div ng-if="item.reply_count && !mine" ng-bind-html="replyCountTexts[item.type]+'.'+pluralCat(item.reply_count) | translate:{value: item.reply_count}"></div>
					<div ng-if="!item.reply_count">{{:: 'NO_REPLY' | translate}}</div>
				</div>
			</footer>
		</article>
	</div>
</article>