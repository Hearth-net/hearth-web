<h1 ng-show="loaded" class="text-center">{{'h1.profile_edit' | translate}}</h1>

<div class="row profile-edit profile-edit-common" ng-show="loaded">
	<form id="profileEditForm" name="profileEditForm" ng-submit="update()" novalidate>
		<div class="right small-12 large-5 medium-12 columns" ng-cloak>
			<div image-preview files="profile.avatar" limit="5" limit-pixel-size="400" single-file="true">
				<img class="preview" ng-if="profile.avatar.file" ng-src="{{profile.avatar.file}}" resized-thumbnail-image exif-rotated/>
				<img class="preview" ng-if="!profile.avatar.file && profile.avatar.large" ng-src="{{profile.avatar.large}}" resized-thumbnail-image/>

				<div class="text">
					<span class="fa fa-plus-square-o"></span>
					<span>{{:: 'CHOOSE_AVATAR_FILE' | translate}}</span>
				</div>
			</div>
		</div>
		<div class="left small-12 large-7 medium-12 alt-bg">
			<h2 class="hide-border">
				<span class="content">
					<span class="fa fa-user"></span>{{:: 'WHO' | translate }}
				</span>
			</h2>
			<section class="who">
				<div class="name row">
					<div class="large-6 small-12 medium-6 columns margin">
						<label for="first_name">
							{{:: 'FIRST_NAME' | translate }} *
							<input-max-length input-type="input" show-counter="false" min-length="2" max-length="200" required="true" placeholder="{{:: 'FIRST_NAME' | translate }}" model="profile.first_name" name="first_name" id="first_name"></input-max-length>
							<div class="error" ng-show="profileEditForm.first_name.$error.required">
								<span>{{:: 'ERR_NOT_FILLED_FIRST_NAME' | translate }}</span>
							</div>
						</label>
					</div>
					<div class="large-6 small-12 medium-6 columns margin">
						<label for="last_name">
							{{:: 'LAST_NAME' | translate }}
							<input type="text" name="last_name" ng-model="profile.last_name" id="last_name" />
						</label>
					</div>
				</div>
				<div class="name margin">
					<label>
						{{:: 'USER_MOTTO' | translate }}
						<input type="text" name="motto" ng-model="profile.motto" class="text-input" maxlength="{{parameters.MAX_MOTTO_LENGTH}}" ng-maxlength="parameters.MAX_MOTTO_LENGTH" placeholder="{{:: 'USER_MOTTO_EXAMPLE' | translate }}" />
						<div class="absolute error">
							<span ng-show="profileEditForm.motto.$error.maxlength">{{:: 'ERR_USER_MOTTO_MAX_LENGTH' | translate }}</span>
						</div>
					</label>
				</div>
			</section>
		</div>
		<div class="clear"></div>
		<h2>
			<span class="content">
				<span class="fa fa-heart"></span>{{:: 'ABOUT_ME' | translate }}
			</span>
		</h2>
		<section class="interests">
			<div class="large-6 small-12 medium-6 columns small-margin-bottom">
				<label>
					{{:: 'MY_TELL_ABOUT' | translate }}
				</label>
				<input-max-length input-type="textarea" show-counter="true" min-length="0" max-length="300" placeholder="{{'MY_TELL_ABOUT_EXAMPLE' | translate }}" model="profile.about" name="about"></input-max-length>
			</div>
			<div class="large-6 small-12 medium-6 columns">
				<label for="interests">
					{{:: 'MY_INTERESTS' | translate }}
				</label>
				<tags-input id="interests" ng-model="profile.interests" name="interests" display-property="term" placeholder="{{'MY_INTERESTS_EXAMPLE' | translate }}" replace-spaces-with-dashes="false">
					<auto-complete source="loadInterests($query)" min-length="0" load-on-focus="true" load-on-empty="true" max-results-to-show="20" highlight-matched-text="true"></auto-complete>
				</tags-input>
			</div>
			<div class="large-12 small-12 columns margin-top-medium">
				<label>
					{{:: 'MY_WORK' | translate }}
					<input class="text-input" type='text' placeholder="{{'MY_WORK_EXAMPLE' | translate}}" ng-model="profile.work" name="my_work">
				</label>
			</div>
		</section>
		<div class="clear"></div>
		<div class="large-12 small-12 medium-12">
			<h2>
				<span class="content">
					<span class="fa fa-globe"></span>{{:: 'WHERE' | translate }}
				</span>
			</h2>
			<section class="location" ng-if="profile">
				<locations locations="profile.locations" is-required="true" show-error="showError.locations"></locations>
			</section>
			<h2>
				<span class="content">
					<span class="fa fa-comments"></span>{{:: 'MY_LANGUAGES' | translate }}
				</span>
			</h2>

			<section class="languages">
				<tags-input ng-model="filteredLangsUser" display-property="translate" placeholder="{{:: 'ADD_OTHER_LANG' | translate}}" replace-spaces-with-dashes="false" add-from-autocomplete-only="true">
					<auto-complete source="loadLanguages($query)" min-length="0" load-on-focus="true" load-on-empty="true" max-results-to-show="32" highlight-matched-text="true"></auto-complete>
				</tags-input>
			</section>
			<div class="clear"></div>
			<h2>
				<span class="content">
					<span class="fa fa-phone"></span>{{:: 'CONTACTS' | translate }}
				</span>
			</h2>
			<section class="contact">
				<!-- main EMAIL -->
				<div class="clearfix">
					<div class="large-6 small-12 medium-6 columns">
						<label>{{:: 'MY_EMAIL' | translate }} *</label>
						<input ng-model="profile.email" ng-focus="showError.email = false" ng-blur="showError.email = true" class="text-input" type='email' name="email" ng-required="true">

						<div class="error" ng-show="showError.email">
							<span ng-show="profileEditForm.email.$error.email">{{:: 'ERR_NOT_VALID_EMAIL' | translate }}</span>
							<span ng-show="profileEditForm.email.$error.required">{{:: 'ERR_NOT_FILLED_EMAIL' | translate }}</span>
						</div>
					</div>

					<div class="large-6 small-12 medium-6 columns">
						<label>{{:: 'PROFILE.CONTACT.WHO_CAN_SEE_IT' | translate }}</label>
						<privacy-selector ng-model="profile.visible_attributes.email"></privacy-selector>
					</div>

					<div class="large-12 small-12 medium-12 columns">
						<a ng-click="showContactMail = true || profile.contact_email !=''" ng-hide="showContactMail" class="controll">
							<span class="fa fa-plus-square"></span>{{:: 'ADD' | translate }}
						</a>
					</div>
				</div>

				<!-- contact email -->
				<div ng-show="showContactMail" class="contact-email clearfix">
					<div class="large-6 small-12 medium-6 columns">
						<label>{{:: 'MY_CONTACT_EMAIL' | translate }}</label>
						<input ng-model="profile.contact_email" ng-focus="showError.contact_email = false" ng-blur="contactEmailBlur()" class="text-input" name="contact_email" type='email'>

						<div class="error" ng-show="showError.contact_email">
							<span ng-show="profileEditForm.contact_email.$error.email">{{:: 'ERR_NOT_VALID_EMAIL' | translate }}</span>
							<span ng-show="profileEditForm.contact_email.$error.required">{{:: 'ERR_NOT_FILLED_CONTACT_EMAIL' | translate }}</span>
						</div>
					</div>
					<div class="large-6 small-12 medium-6 columns">
						<label>{{:: 'PROFILE.CONTACT.WHO_CAN_SEE_IT' | translate }}</label>
						<privacy-selector ng-model="profile.visible_attributes.contact_email"></privacy-selector>
					</div>

					<div class="large-12 small-12 medium-12 columns">
						<em>{{:: 'MY_CONTACT_EMAIL_EXAMPLE' | translate }}</em>
					</div>

					<div class="large-12 small-12 medium-12 columns margin-top">
						<a ng-click="hideContactEmail()" class="controll">
							<span class="fa fa-minus-square"></span>{{:: 'REMOVE' | translate }}
						</a>
					</div>
				</div>

				<!-- phone -->
				<div class="margin-top clearfix">
					<div class="large-6 small-12 medium-6 columns">
						<label>
							<i class="fa fa-phone"></i> {{:: 'MY_PHONE' | translate }}</label>
						<input ng-model="profile.phone" ng-focus="showError.phone = false" ng-blur="showError.phone = true" name="phone" class="text-input" type="text" ng-pattern="/((\+420|00420) ?)?\d{3}( |-)?\d{3}( |-)?\d{3}/">

						<div class="error" ng-show="showError.phone">
							<span ng-show="profileEditForm.phone.$error.pattern">{{:: 'ERR_NOT_VALID_PHONE' | translate }}</span>
						</div>
					</div>

					<div class="large-6 small-12 medium-6 columns">
						<label>{{:: 'PROFILE.CONTACT.WHO_CAN_SEE_IT' | translate }}</label>
						<privacy-selector ng-model="profile.visible_attributes.phone"></privacy-selector>
					</div>
				</div>
			</section>

			<div class="clear"></div>
			<h2>
				<span class="content">
					<span class="fa fa-envelope"></span>{{:: 'MY_NETWORKS' | translate }}
				</span>
			</h2>
			<section class="social">
				<div class="large-6 small-12 medium-6 columns">
					<label>
						{{:: 'MY_FACEBOOK' | translate }}
						<input placeholder="{{ 'EG' | translate }} https://www.facebook.com/profile" ng-model="profile.facebook" class="text-input" type="url" ng-blur="updateUrl($event, profile, 'facebook')">
					</label>
					<div class="error" ng-show="showError.social_networks['facebook']">
						<span>{{:: 'ERR_SOCIAL_NETWORK_NAME' | translate }}</span>
					</div>
				</div>
				<div class="large-6 small-12 medium-6 columns">
					<label>
						{{:: 'MY_TWITTER' | translate }}
						<input placeholder="{{ 'EG' | translate }} https://twitter.com/profile" ng-model="profile.twitter" class="text-input" type="url" ng-blur="updateUrl($event, profile, 'twitter')">
					</label>
					<div class="error" ng-show="showError.social_networks['twitter']">
						<span>{{:: 'ERR_SOCIAL_NETWORK_NAME' | translate }}</span>
					</div>
				</div>
				<div class="large-6 small-12 medium-6 columns">
					<label>
						{{:: 'MY_LINKEDIN' | translate }}
						<input placeholder="{{ 'EG' | translate }} https://www.linkedin.com/profile" ng-model="profile.linkedin" class="text-input" type="url" ng-blur="updateUrl($event, profile, 'linkedin')">
					</label>
					<div class="error" ng-show="showError.social_networks['linkedin']">
						<span>{{:: 'ERR_SOCIAL_NETWORK_NAME' | translate }}</span>
					</div>
				</div>
				<div class="large-6 small-12 medium-6 columns">
					<label>
						{{:: 'MY_GOOGLEPLUS' | translate }}
						<input placeholder="{{ 'EG' | translate }} https://plus.google.com/profile" ng-model="profile.googleplus" class="text-input" type="url" ng-blur="updateUrl($event, profile, 'googleplus')">
					</label>
					<div class="error" ng-show="showError.social_networks['googleplus']">
						<span>{{:: 'ERR_SOCIAL_NETWORK_NAME' | translate }}</span>
					</div>
				</div>
			</section>
			<div class="clear"></div>
			<section class="webs">
				<div class="large-6 small-12 medium-6 columns">
					<label>
						<span class="fa fa-globe"></span> {{:: 'MY_WEB' | translate }}
					</label>

					<div ng-repeat="web in profile.webs track by $index" class="web-item">
						<input placeholder="{{ 'EG' | translate }} https://www.myweb.com" ng-model="profile.webs[$index]" class="text-input" type="url" ng-required="!$first" ng-blur="updateUrl($event, profile.webs, $index)">

						<div class="remove" ng-hide="$first">
							<span class="fa fa-times-circle" ng-click="profile.webs.splice($index,1)"></span>
						</div>
					</div>

					<div class="error margin" ng-show="showError.social_networks['webs']">
						<span>{{:: 'ERR_INVALID_URL' | translate }}</span>
					</div>

					<a ng-click="profile.webs.push('')">
						<span class="fa fa-plus-square"></span>{{:: 'ADD_NEXT_WEB' | translate }}
					</a>
				</div>
				<div class="clear"></div>
			</section>
			<div class="clear"></div>
			<br/>
			<br/>
			<section>
				<div class="display-flex flex-reverse flex-space-between">
					<button type="submit" class="button-send" analytics-custom analytics-event="edit my profile" analytics-category="My profile" analytics-value="5">{{:: 'SAVE' | translate }}</button>
					<a ui-sref="profile.default({id: loggedUser._id})" class="revert-changes">{{:: 'CANCEL_CHANGES' | translate }}</a>
				</div>
			</section>
		</div>
	</form>
</div>
<div loading show="!loaded"></div>