<div class="itemEdit modal">
    <div class="head">
        <h2 class="fa fa-pencil">
            <span ng-if="post._id">
                {{ 'EDIT_POST' | translate }}
                <small ng-if="loggedCommunity">({{ 'DOING_AS_COMMUNITY' | translate }} <b>{{ loggedCommunity.name | ellipsis:30 }})</b></small>
            </span>
            <span ng-if="! post._id">
                {{ 'CREATE_POST' | translate }}
                <small ng-if="loggedCommunity">({{ 'DOING_AS_COMMUNITY' | translate }} <b>{{ loggedCommunity.name | ellipsis:30 }})</b></small>
            </span>
        </h2>
        <span ng-click="closeThisDialog()" class="close fa fa-times"></span>
    </div>
    <hr />
    <form ng-submit="save(post)" name="createAdForm" novalidate class="create-ad">
        <div>
            <div class="edit-post-notify-container"></div>
            <p class="error" ng-if="showInvalidPostMessage">{{ 'ERR_ACTION_FAILED_DUE_TO_ERRORS' | translate  }}</p>
            <div class="messageBox" ng-if="!isPostActive(post)">
                <span ng-if="post.state == 'expired' && post.dateOrig">{{ 'POST_HAS_EXPIRED' | translate  }} {{ post.valid_until | date:DATETIME_FORMATS.mediumDate }}</span>
                <span ng-if="post.state == 'expired' && !post.dateOrig ">{{ 'POST_HAS_ALREADY_EXPIRED' | translate  }}</span>
                <span ng-if="post.state == 'suspended'">{{ 'POST_HAS_BEEN_DEACTIVATED' | translate }} {{ post.suspended_at | date:DATETIME_FORMATS.medium }}</span>
            </div>

            <section class="author">
                <author-selector class="fleft" id="author" author="post.current_community_id"></author-selector>

                <needofferselector ng-if="!post.current_community_id" class="fleft" model="post.type" text-true="{{ 'NEED' | translate }}" text-false="{{ 'OFFER' | translate }}"></needofferselector>
                <needofferselector ng-if="post.current_community_id" class="fleft" model="post.type" text-true="{{ 'WE_NEED' | translate }}" text-false="{{ 'WE_GIVE' | translate }}"></needofferselector>
                <div class="clear"></div>
            </section>
            
            <section class="title">
                <label for="title">{{ 'POST_TITLE_LABEL' | translate }}</label>
                <div class="name">
                    <input type="text" name="title" class="form-control" ng-minlength="3" ng-maxlength="100" placeholder="{{'TELL_WHAT' | translate}}" ng-model="post.title" class="text-input top" required ng-blur="showError.title = true" ng-focus="showError.title = false">

                    <div class="moveUp error" ng-show="createAdForm.title.$invalid && showError.title">
                        <span ng-show="createAdForm.title.$error.required">{{ 'ERR_AD_TITLE_MIN_LEN' | translate }}</span>
                        <span ng-show="createAdForm.title.$error.minlength">{{ 'ERR_AD_TITLE_MIN_LEN' | translate }}</span>
                        <span ng-show="createAdForm.title.$error.maxlength">{{ 'ERR_AD_TITLE_LEN' | translate }}</span>
                    </div>
                </div>
            </section>

            <section class="text">
                <label for="text">{{ 'POST_TEXT_LABEL' | translate }}</label>
                <textarea autosize-textarea ng-focus="showError.text = false" ng-blur="showError.text = true" required placeholder="{{ 'WHAT_YOU_NEED_OR_OFFER_PLACEHOLDER' | translate }}" ng-minlength="3" ng-maxlength="2500" ng-model="post.name" name="text" ng-class="{ 'offset-text focused top': isCreatingAd() || isEditingAd()}" ng-keydown="escapeKey($event)" ng-focus="startCreatingAd()" ng-cloak class="create-ad-textarea text-input middle"></textarea>
                <div class="moveUp error" ng-show="createAdForm.text.$invalid && showError.text">
                    <span ng-show="createAdForm.text.$error.required">{{ 'ERR_AD_TEXT_MIN_LEN' | translate }}</span>
                    <span ng-show="createAdForm.text.$error.minlength">{{ 'ERR_AD_TEXT_MIN_LEN' | translate }}</span>
                    <span ng-show="createAdForm.text.$error.maxlength">{{ 'ERR_AD_TEXT_LEN' | translate }}</span>
                </div>
            </section>

            <section class="text-input communitiy-selector keywords field-container" ng-if="myCommunities.length">
                <label class="moveBot">
                    <i class="fa fa-users"></i> {{ 'POST_COMMUNITIES_LABEL' | translate }}
                </label>
                <community-selector disable="post.current_community_id" communities="post.related_communities"></community-selector>
            </section>

            <section class="text-input keywords field-container">
                <label class="moveBot">
                    <i class="fa fa-tags"></i> {{ 'POST_KEYWORDS_LABEL' | translate }}
                </label>

                <tags-input refocus-input-on-tab class="tags" ng-model="post.keywords" placeholder="{{ 'ADD_KEYWORDS' | translate }}" replace-spaces-with-dashes="false" add-on-comma="true" add-on-space="false" allowed-tags-pattern="^[a-zA-Z0-9\sĚŠČŘŽÝÁÍÉÚŮĎŤŇÓěščřžýáíéúůďťňó]+$" min-length="2" max-length="20">
                    <auto-complete source="queryKeywords($query)" min-length="2" debounce-delay="400" max-results-to-show="8"></auto-complete>
                </tags-input>
            </section>

            <section class="place text-input middle field-container">
                <label>
                    <i class="fa fa-map-marker"></i> {{ 'POST_PLACE_LABEL' | translate}}
                </label>
                <locations locations="post.locations" base="#ngdialog1" limit="post.location_unlimited" show-error="showError.locations" error-code="LOCATIONS_ARE_EMPTY"></locations>
            </section>
            <section class="date">
                <label>
                    <i class="fa fa-clock-o"></i> {{ 'POST_EXPIRATION_DATE_LABEL' | translate}}
                </label>
                <div ng-class="{disabled: post.valid_until_unlimited == true}">
                    <input type="text" ng-focus="focusDate(post.valid_until)" ng-blur="blurDate(post.valid_until)" name="valid_until" ng-disabled="post.valid_until_unlimited == true" class="date" datepicker="{{language}}" datepicker-format="{{dateFormat}}" ng-model="post.valid_until" placeholder="{{'UNLIMITED' | translate}}" required>
                    <checkbox model="post.valid_until_unlimited" on-update="dateUnlimitedToggle()" value="true">{{ 'UNLIMITED' | translate }}</checkbox>
                    <div class="clear error" ng-show="showError.valid_until">
                        <span ng-show="createAdForm.valid_until.$error.required">{{ 'DATE_IS_EMPTY' | translate }}</span>
                        <span ng-show="createAdForm.valid_until.$error.invalid">{{ 'ERR_DATE_IS_OLD' | translate }}</span>
                    </div>
                </div>
            </section>
            <section class="files">
                <label class="create-post-link">
                    <i class="fa fa-picture-o" style="padding-right:5px;"></i> {{ 'ATTACH_PHOTO_LINK' | translate }}
                </label>
                <ul class="fileList">
                    <li id="image-preview-{{$index}}" ng-if="! file._id || ! file.deleted" class="text-center" ng-class="{active: ! file._id || ! file.deleted}" ng-repeat="file in post.attachments_attributes track by $index">
                        <div class="overlay"></div>
                        <a ng-click="removeImage($index)" title="{{ 'CLICK_TO_REMOVE_PHOTO_HINT' | translate }}">
                            <i class="fa fa-times"></i>
                        </a>
                        <img resized-thumbnail-image ng-src="{{ file.file || file.normal }}" class="padding-1">
                    </li>
                    <li class="file-upload">
                        <div image-preview no-encoding="true" limit-pixel-size="200" files="post.attachments_attributes" limit="5">
                            <i class="fa fa-plus"></i>
                        </div>
                    </li>
                </ul>
                <div class="clear"></div>
            </section>

            <section class="lock">
                <label for="lock">
                    {{ 'POST_LOCK_LABEL' | translate }}
                </label>
                <ul>
                    <li>
                        <input type="radio" id="private_none" name="private" ng-model="post.is_private" ng-value="false" ng-checked="!post.is_private" />
                        <label for="private_none">{{ 'VISIBLE_FOR_ALL' | translate }}</label>
                    </li>
                    <li>
                        <input type="radio" id="private" name="private" ng-model="post.is_private" ng-value="true" ng-checked="post.is_private" />
                        <label ng-if="!post.current_community_id" for="private">{{ 'VISIBLE_FOR_FRIENDS' | translate }}</label>
                        <label for="private" ng-if="post.current_community_id">{{ 'VISIBLE_FOR_MEMBERS' | translate }}</label>
                    </li>
                </ul>
            </section>

            <section class="bottom">
                <a href="" ng-click="closeEdit()" class="fleft close">
                    {{ 'CLOSE' | translate }}
                </a>
                <button ng-if="post.state == 'suspended' || post.state == 'expired'" class="primary button-send fright pointer margin-left-10" type="button" ng-click="save(post, true)" analytics-event="click on send" analytics-category="Add" analytics-label="NP" translate>SAVE_AND_ACTIVATE</button>

                <button class="primary button-send fright pointer" type="submit" analytics-event="click on send" analytics-category="Add" analytics-label="NP" translate>SAVE</button>

                <a class="fright deleteLink" ng-if="post._id" ng-click="confirmBox('AD_REMOVE_LABEL', 'AD_REMOVE_ARE_YOU_SURE', deleteItem, post)">
                    <i class="fa fa-times"></i>{{ 'DELETE' | translate }}
                </a>
            </section>
        </div>
    </form>
</div>