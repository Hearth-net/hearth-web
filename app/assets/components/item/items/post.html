<article suspendable class="item-common item-post bubbled" id="post_{{:: item._id }}" ng-class=":: {inactive: !isActive, 'hidden-init': delayedView, 'hiddenAvatar': hideAvatar}">
	<div class="row">
		<section ng-if=":: !hideAvatar" class="column medium-2 show-for-medium padding-top-small position-relative">
			<div info-box=":: item.author">
				<div class="v2 user text-center">
					<a ng-href="{{:: getProfileLink(item.author._type, item.author._id)}}" history-param-pusher="item._id" class="display-block">
						<avatar class="" type=":: item.author._type" src=":: item.author.avatar.large"></avatar>
						<div class="name" test-beacon="marketplace-item-author-name">{{:: item.author.name}}</div>
					</a>
				</div>
			</div>
			<!-- <div class="item-option-bg-type by-avatar" ng-class="'item-option-bg-' + item.type">
				<i class="fa fa-fw" ng-class="(item.exact_type == 'loan' ? 'fa-clock-o' : 'fa-heart')"></i>
			</div> -->

			<div class="item-option-bg-type by-avatar" ng-class="'item-option-bg-' + (item.exact_type == 'gift' ? item.type : (item.type == 'offer' ? 'lend' : 'borrow'))">
				<i></i>
			</div>
			<div class="v2 user text-center">
				<karma-bar for=":: item.author"></karma-bar>
			</div>
		</section>
		<div class="column small-12 medium-10 padding-none position-relative" ng-class=":: {'medium-push-1': hideAvatar}">
			<div class="sharing-container ng-hide" ng-show="showSharing" ng-click="showSharing = false">
				<div class="sharing-container-form">
					<a class="fa touchable fa-times close" ng-click="showSharing = false"></a>
					<h3>{{:: 'MARKETPLACE.POST.SHARE_LINK' | translate }}</h3>
					<div class="input-container medium-display-table">
						<div class="medium-display-table-cell addon">
							<i class="fa fa-link"></i>
						</div>
						<div class="medium-display-table-cell">
							<input type="text" readonly select-on-focus value="{{:: getProfileLink('Post', item._id, true) }}" ng-click="$event.stopPropagation()" />
						</div>
					</div>
					<ul class="no-list">
						<li>
							<a analytics-custom analytics-event="Share" analytics-category="Email" analytics-label="Share post by email" class="fa fa-envelope" title="Email" ng-click="openEmailSharingBox(item)"></a>
						</li>
						<li>
							<a analytics-custom analytics-event="Share" analytics-category="Facebook" analytics-label="Share post on facebook" sharing-window class="fa fa-facebook" title="Facebook" ng-href="{{:: socialLinks.facebook+postAddress}}" target="_blank"></a>
						</li>
						<li>
							<a analytics-custom analytics-event="Share" analytics-category="Google+" analytics-label="Share post on google+" sharing-window class="fa fa-google-plus" title="Google+" ng-href="{{:: socialLinks.gplus+postAddress}}" target="_blank"></a>
						</li>
						<li>
							<a analytics-custom analytics-event="Share" analytics-category="Twitter" analytics-label="Share post on twitter" sharing-window class="fa fa-twitter" title="Twitter" ng-href="{{:: socialLinks.twitter+postAddress}}" target="_blank"></a>
						</li>
					</ul>
				</div>
			</div>
			<section class="box padding-none" ng-init="marketplace.expanded = false;">
				<div class="box-content">
					<header class="item-section row">
						<div class="column small-8 small-push-4 medium-5 medium-push-7 large-4 large-push-8 text-right nowrap">
							<span class="color-dark-gray" title="{{:: item.updated_at_date }}">{{:: item.updated_at_timeago}}</span>
							<div class="dropdown-wrapper">
								<div class="display-inline-block touchable-wrapper margin-left-none position-relative" ng-if=":: !mine">
									<div bubble-placeholder="bookmark-reminder"></div>
									<div bubble-placeholder="hide-post"></div>
									<span ng-click="removeReminder({event: $event, type: 'hide_post', reason: 'dropdown-arrow-click'}); removeReminder({event: $event, type: 'bookmark', reason: 'dropdown-arrow-click'}); analytics('Dropdown clicked');" class="action-dropdown touchable touchable-small touchable-match-line-height padding-vertical-none margin-left-medium round gray"
													title="{{:: 'POSTS.DETAIL.EXPAND_MORE_INFO' | translate }}" dropdown="#more-actions-{{:: item._id}}" test-beacon="marketplace-item-dropdown-toggle">
										<i class="fa fa-fw fa-chevron-down"></i>
									</span>
								</div>
								<ul class="actions-dropdown text-left" id="more-actions-{{:: item._id }}" style="display:none;">
									<li>
										<!-- bookmark post -->
										<a ng-if="! mine && item.is_bookmarked" ng-click="ItemAux.removeItemFromBookmarks(item);  analytics('Unbookmark clicked');" test-beacon="marketplace-item-remove-bookmark">{{:: 'MARKETPLACE.POST.UNBOOKMARK_POST' | translate }}</a>
										<a ng-if="! mine && !item.is_bookmarked " ng-click="ItemAux.addItemToBookmarks(item); analytics( 'Bookmark clicked');" test-beacon="marketplace-item-add-bookmark">{{:: 'MARKETPLACE.POST.BOOKMARK_POST' | translate }}</a>
										<!-- /bookmark post -->
									</li>
									<li>
										<!-- flag post -->
										<a ng-if="! mine && item.spam_reported" title="{{:: 'REPORT_HARMFUL_AD_ONLY_ONCE' | translate}}" tipsy disabled>{{:: 'MARKETPLACE.POST.FLAG_POST' | translate }}</a>
										<a ng-if="! mine && !item.spam_reported" title="{{:: 'REPORT_HARMFUL_AD' | translate}}" ng-click="openReportBox(item)" test-beacon="marketplace-item-flag">{{:: 'MARKETPLACE.POST.FLAG_POST' | translate }}</a>
										<!-- /flag post -->
									</li>
									<li>
										<!-- hide post -->
										<a ng-if="!mine && !item.is_hidden" title="{{:: 'HIDE_AD' | translate}}" ng-click="confirmBox('POST.HIDE.LABEL', 'POST.HIDE.ARE_YOU_SURE', ItemAux.hideItem, item, this)">{{:: 'MARKETPLACE.POST.HIDE_POST' | translate }}</a>
										<!-- /hide post -->
									</li>
									<li>
										<a ng-if=":: ! mine && item.admin_communities.length" title="{{:: 'MARKETPLACE.POST.REMOVE_FROM_COMMUNITY' | translate}}" ng-click="removeItemFromCommunity(item)">{{:: 'MARKETPLACE.POST.REMOVE_FROM_COMMUNITY' | translate }}</a>
									</li>

									<!-- admin only -->
									<li ng-if=':: userHasRight("post.suspend") && isActive'>
										<hr />
									</li>
									<li ng-if=':: userHasRight("post.suspend") && isActive'>
										<a class='elevated-authority-function' ng-click="(isActive ? ItemAux.confirmSuspend(item, this) : pauseToggle(item, 'confirm-pause-' + item._id))">
											<span ng-if="isActive">{{:: "POST.SUSPEND.LABEL" | translate }}</span>
											<span ng-if="!isActive">{{:: "POST.RESUME.LABEL" | translate }}</span>
										</a>
									</li>
									<!-- TODO: in future there will be another user privilegs then post.suspend -->
									<li ng-if=':: userHasRight("post.suspend")'>
										<a ng-if=":: !item.is_followed" class="elevated-authority-function" ng-click="followItem(item)">{{:: "POST.FOLLOW.LABEL" | translate}}</a>
										<a ng-if=":: item.is_followed" class="elevated-authority-function" ng-click="unfollowItem(item)">{{:: "POST.UNFOLLOW.LABEL" | translate}}</a>
									</li>
                  <li ng-if=':: userHasRight("post.suspend")'>
                    <hr />
                    <span>{{:: "CHARACTER" | translate}}:
                       <span ng-repeat="itemEntry in item.character">
                          <span ng-repeat="postCharEntry in postCharacter | filter : { name:itemEntry }">{{ postCharEntry.translate | translate }}</span>
                       </span>
                    </span>
                  </li>
                  <li ng-if=':: userHasRight("post.suspend")'>
                    <span>{{:: "USER_LANGUAGE" | translate}}: {{:: postLanguage}} </span>
                  </li>
									<!-- /admin only -->
								</ul>
							</div>
						</div>
						<div class="column small-4 small-pull-8 hide-for-medium">
							<a ng-if="! hideAvatar" ng-href="{{:: getProfileLink(item.author._type, item.author._id)}}" class="position-relative">
								<avatar class="" type=":: item.author._type" src=":: item.author.avatar.normal" size="small"></avatar>
								<div class="item-option-bg-type by-avatar" ng-class=":: 'item-option-bg-' + item.type">
									<i class="fa fa-fw" ng-class=":: (item.exact_type == 'loan' ? 'fa-clock-o' : 'fa-heart')"></i>
								</div>
							</a>
						</div>
						<div class="column small-12 medium-7 medium-pull-5 large-8 large-pull-4">
							<h1>
								<a ng-href="{{:: getProfileLink('Post', item._id)}}" history-param-pusher='item._id'>
									<span ng-class=":: 'color-' + item.type" translate="{{:: postTypes[item.author._type][item.exact_type][item.type] }}"></span>
									<span ng-bind=":: item.title" test-beacon="marketplace-item-post-title"></span>
								</a>
							</h1>
							<span class="nowrap" ng-if=":: isExpiringSoon">{{:: 'POSTS.DETAIL.POST_EXPIRING_SOON' | translate }}</span>
							<div ng-if=":: item.edited_by_admin && userHasRight('post.suspend') && !isActive" class="error">{{:: 'POST.SUSPENDED_BY_ADMIN' | translate }}</div>
							<span class="fa fa-lock" ng-if=":: item.is_private" title="{{:: 'VISIBLE_FOR_FRIENDS' | translate }}"></span>
						</div>

						<div class="column small-12">
							<div ng-if="item.location_unlimited">
								<i class="fa fa-map-marker"></i>&nbsp;{{:: 'MARKETPLACE.POST.LOCATION_ANYWHERE_HEADING' | translate }}
							</div>
							<div ng-if=":: !item.location_unlimited">
								<span ng-repeat="(locationId, location) in :: item.locations track by $index">
									<span ng-if=":: location.short_address">
										<i class="fa fa-map-marker" ng-if=":: $first"></i>&nbsp;{{:: location.short_address }}
										<span ng-if=":: !$last">;</span>
									</span>
								</span>
							</div>
						</div>
					</header>

					<div class="item-section text-container word-wrap">
						<p class="margin-none" ng-if="item.text.length < 270 || marketplace.expanded == true" ng-bind-html=":: item.text_parsed" test-beacon="marketplace-item-text"></p>
						<p class="margin-none" ng-if="item.text.length >= 270 && !marketplace.expanded">
							<span ng-bind-html=":: item.text_short_parsed"></span>
							<a ng-click="marketplace.expanded = true">
								<b ng-class="'color-' + item.type">{{:: 'MARKETPLACE.POST.CLICK_TO_EXPAND' | translate }}</b>
							</a>
						</p>
					</div>
					<ul lemmon-slider fancybox="{{:: item._id}}" ng-if="item.attachments_attributes.length" class="item-section">
						<li ng-repeat="photo in :: item.attachments_attributes track by $index">
							<a class="fancy" ng-href="{{:: photo.large }}" rel="{{:: item._id}}">
								<img class="post-image" ng-src="{{:: photo.normal}}" event-emitter="{event: 'initLemmonSlider', data: {isLast: $last}, waitFor: 'load'}" />
							</a>
						</li>
					</ul>
          <div class="item-section tags" ng-class="{'tagsActive': !inactivateTags}" ng-if=":: item.keywords.length">
						<ul class="tagList">
							<li ng-click="toggleTag(tag)" ng-class=":: {active: keywords.indexOf(tag) !== -1}" ng-repeat="tag in :: item.keywords track by $index" ng-bind=":: tag" test-beacon="marketplace-keywords"></li>
						</ul>
					</div>
				</div>
				<footer>
					<div class="display-table nowrap">
						<div class="display-table-cell vertical-align-middle">
							<div class="display-flex flex-wrap">
								<div class="padding-right-large" ng-if=":: mine">
									<div class="touchable-wrapper">
										<a class="touchable" title="{{:: 'POST.EDIT.LABEL' | translate}}" ng-click="edit(item)">
											<i class="fa fa-fw fa-pencil"></i>
										</a>
										<a class="touchable" title="{{:: 'POST.RESUME.LABEL' | translate}}" ng-if=":: !isActive" ng-click="pauseToggle(item, 'confirm-pause-'+item._id)">
											<i class="fa fa-fw" ng-class=":: {'fa-refresh': item.state == 'expired', 'fa-play': item.state == 'suspended'}"></i>
										</a>
										<a class="touchable" title="{{:: 'POST.SUSPEND.LABEL' | translate}}" ng-if="isActive" ng-click="confirmBox('POST.SUSPEND.LABEL', 'POST.SUSPEND.ARE_YOU_SURE', pauseToggle, item, this)">
											<i class="fa fa-fw fa-pause"></i>
										</a>
										<a class="touchable" title="{{:: 'POST.REMOVE.LABEL' | translate}}" ng-click="confirmBox('POST.REMOVE.LABEL', 'POST.REMOVE.ARE_YOU_SURE', deleteItem, item, this)">
											<i class="fa fa-fw fa-times"></i>
										</a>
									</div>
								</div>
								<div class="padding-right-large" ng-if="(!item.is_replied && !mine) || (item.is_replied)">
									<button ng-if="!item.is_replied && !mine" ng-click="ItemAux.replyItem(item); analytics('Reply clicked');" class="button" ng-class=":: item.type" ng-bind-html=":: replyLabel[item.type] | translate"></button>
									<span ng-if="item.is_replied">
										{{:: 'YOU_HAVE_ALREADY_REPLIED_TO_THIS_POST' | translate }}
									</span>
								</div>
								<div>
									<div ng-if="item.reply_count && mine">
										<a class="text-decoration-underline" ng-href="{{getProfileLink('Post', item._id) }}#replies" ng-bind-html="item.replied_by_string"></a>
									</div>
									<div ng-if="item.reply_count && !mine" ng-bind-html="item.replied_by_string"></div>
									<div ng-if="!item.reply_count" test-beacon="marketplace-reply">{{:: 'NO_REPLY' | translate}}</div>
								</div>
							</div>
						</div>
						<div class="display-table-cell addon vertical-align-top text-align-right" id="open-sharing-options">
							<div class="touchable-wrapper">
								<a class="touchable" ng-click="showSharing = !showSharing; scrollToElement('#post_' + item._id + '.sharing-container-form', null, 140); analytics('Sharing clicked');" title="Share">
									<i class="fa fa-fw fa-share-alt"></i>
								</a>
							</div>
						</div>
					</div>
				</footer>
			</section>
		</div>
	</div>
</article>
